#!/bin/bash

# Enable strict error handling
set -euo pipefail

# Output formatting functions
log_info() {
    echo "$*"
}

log_success() {
    echo "✓ $*"
}

# Function to display DockerKit logo
show_dockerkit_logo() {
    cat << 'EOF'
$$$$$$$\                      $$\                           $$\   $$\ $$\   $$\
$$  __$$\                     $$ |                          $$ | $$  |\__|  $$ |
$$ |  $$ | $$$$$$\   $$$$$$$\ $$ |  $$\  $$$$$$\   $$$$$$\  $$ |$$  / $$\ $$$$$$\
$$ |  $$ |$$  __$$\ $$  _____|$$ | $$  |$$  __$$\ $$  __$$\ $$$$$  /  $$ |\_$$  _|
$$ |  $$ |$$ /  $$ |$$ /      $$$$$$  / $$$$$$$$ |$$ |  \__|$$  $$<   $$ |  $$ |
$$ |  $$ |$$ |  $$ |$$ |      $$  _$$<  $$   ____|$$ |      $$ |\$$\  $$ |  $$ |$$\
$$$$$$$  |\$$$$$$  |\$$$$$$$\ $$ | \$$\ \$$$$$$$\ $$ |      $$ | \$$\ $$ |  \$$$$  |
\_______/  \______/  \_______|\__|  \__| \_______|\__|      \__|  \__|\__|   \____/
EOF
}

# Function to show system status
show_system_status() {
    log_info "PHP-FPM Service Status:"
    log_info "    ├─ PHP Version → $(php -v 2>/dev/null | head -n1 | cut -d' ' -f2 || echo 'Loading...')"
    log_info "    ├─ PHP-FPM     → $(php-fpm -v 2>/dev/null | head -n1 | cut -d' ' -f2 || echo 'Loading...')"
    log_info "    ├─ Extensions  → $(php -m 2>/dev/null | wc -l || echo '0') loaded"
    log_info "    └─ Process     → $(ps aux | grep -c '[p]hp-fpm' || echo '0') workers"
    echo
}

# Main execution
main() {
    # Clear screen for clean welcome display
    clear

    # Show DockerKit logo
    show_dockerkit_logo

    # Show system status
    show_system_status

    # Final success message
    log_success "PHP-FPM service ready! Processing requests..."
    echo
}

# Execute main function
main
